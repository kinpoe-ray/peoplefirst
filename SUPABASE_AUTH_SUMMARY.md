# Supabaseè®¤è¯é…ç½®å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. ç¯å¢ƒå˜é‡é…ç½® (.env)
- âœ… é…ç½®äº†Supabase URLå’ŒAPI Key
- âœ… æ”¯æŒå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒåˆ‡æ¢
- âœ… æä¾›è¯¦ç»†çš„ç¯å¢ƒå˜é‡è¯´æ˜

### 2. Supabaseå®¢æˆ·ç«¯é…ç½® (src/lib/supabase.ts)
- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡åˆå§‹åŒ–å®¢æˆ·ç«¯
- âœ… å®šä¹‰å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿ
- âœ… å®ç°è§’è‰²æƒé™æ£€æŸ¥å·¥å…·å‡½æ•°
- âœ… æä¾›æ•°æ®åº“æ“ä½œè¾…åŠ©å‡½æ•°

### 3. è®¤è¯ä¸Šä¸‹æ–‡ (src/contexts/AuthContext.tsx)
- âœ… å®Œæ•´çš„ç”¨æˆ·çŠ¶æ€ç®¡ç†
- âœ… ç™»å½•/æ³¨å†Œ/ç™»å‡ºåŠŸèƒ½
- âœ… è‡ªåŠ¨ä¼šè¯æ£€æµ‹å’Œåˆ·æ–°
- âœ… Profileè‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°

### 4. è®¤è¯Hook (src/hooks/useAuth.ts)
- âœ… `useAuth()` - åŸºç¡€è®¤è¯Hook
- âœ… `withAuth()` - è·¯ç”±ä¿æŠ¤é«˜é˜¶ç»„ä»¶
- âœ… `usePermissions()` - æƒé™æ£€æŸ¥Hook
- âœ… `useRoleCheck()` - è§’è‰²æ£€æŸ¥Hook

### 5. UIç»„ä»¶
- âœ… `AuthNavigation.tsx` - å“åº”å¼å¯¼èˆªæ 
- âœ… `AuthStatus.tsx` - è®¤è¯çŠ¶æ€æ˜¾ç¤ºç»„ä»¶
- âœ… `AuthTest.tsx` - è®¤è¯ç³»ç»Ÿæµ‹è¯•é¡µé¢

### 6. RLSç­–ç•¥å¢å¼º
- âœ… å¤šè§’è‰²æƒé™æ§åˆ¶
- âœ… æ•°æ®éš”ç¦»å’Œå®‰å…¨æ€§
- âœ… æ•™å¸ˆç®¡ç†æƒé™
- âœ… è‡ªåŠ¨è§¦å‘å™¨é…ç½®

### 7. æ•°æ®åº“æ”¯æŒ
- âœ… ç”¨æˆ·æ³¨å†Œè‡ªåŠ¨åˆ›å»ºProfile
- âœ… ä¸‰ç§ç”¨æˆ·è§’è‰²æ”¯æŒï¼ˆå­¦ç”Ÿ/è€å¸ˆ/æ ¡å‹ï¼‰
- âœ… å®Œæ•´çš„è¡Œçº§å®‰å…¨ç­–ç•¥

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### è®¤è¯æµç¨‹
1. **æ³¨å†Œ**: ç”¨æˆ·é€‰æ‹©è§’è‰² â†’ åˆ›å»ºAuthç”¨æˆ· â†’ è‡ªåŠ¨åˆ›å»ºProfile
2. **ç™»å½•**: é‚®ç®±/å¯†ç éªŒè¯ â†’ è·å–ä¼šè¯ â†’ åŠ è½½ç”¨æˆ·Profile
3. **æƒé™**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
4. **ç™»å‡º**: æ¸…é™¤ä¼šè¯å’Œæœ¬åœ°çŠ¶æ€

### å¤šè§’è‰²ç³»ç»Ÿ
- **å­¦ç”Ÿ (student)**: æŠ€èƒ½å­¦ä¹ ã€ç¤¾äº¤äº’åŠ¨
- **è€å¸ˆ (teacher)**: è¯¾ç¨‹ç®¡ç†ã€é—®é¢˜åˆ›å»ºã€å­¦ç”Ÿç®¡ç†
- **æ ¡å‹ (alumni)**: è¯¾ç¨‹åˆ›å»ºã€ç¤¾äº¤å‚ä¸ã€èŒä¸šåˆ†äº«

### å®‰å…¨ç‰¹æ€§
- ğŸ”’ è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)
- ğŸ”’ è§’è‰²æƒé™éªŒè¯
- ğŸ”’ æ•°æ®éš”ç¦»ä¿æŠ¤
- ğŸ”’ è‡ªåŠ¨ä¼šè¯ç®¡ç†

## ğŸš€ ä½¿ç”¨æŒ‡å—

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è®¤è¯
```tsx
import { useAuth, usePermissions } from '../hooks/useAuth';

function MyComponent() {
  const { user, profile, isTeacher, signOut } = useAuth();
  const permissions = usePermissions();
  
  if (!user) return <div>è¯·å…ˆç™»å½•</div>;
  
  return (
    <div>
      <h1>æ¬¢è¿ï¼Œ{profile?.full_name}</h1>
      {permissions.canCreateCourse && <CourseCreator />}
    </div>
  );
}
```

### è·¯ç”±ä¿æŠ¤
```tsx
import { withAuth } from '../hooks/useAuth';

const ProtectedPage = withAuth(YourComponent);
```

### æ˜¾ç¤ºç”¨æˆ·çŠ¶æ€
```tsx
import { AuthStatus, RoleBadge } from '../components/AuthStatus';

<UserProfile>
  <AuthStatus showRole showDetails />
  <RoleBadge />
</UserProfile>
```

## ğŸ“ æµ‹è¯•è®¿é—®

### è®¤è¯æµ‹è¯•é¡µé¢
- è®¿é—®è·¯å¾„: `/auth-test`
- åŠŸèƒ½: éªŒè¯æ‰€æœ‰è®¤è¯åŠŸèƒ½
- æ˜¾ç¤º: ç”¨æˆ·ä¿¡æ¯ã€æƒé™çŠ¶æ€ã€è¿æ¥æµ‹è¯•

### ç™»å½•/æ³¨å†Œ
- ç™»å½•: `/login`
- æ³¨å†Œ: `/register`
- æ”¯æŒ: é‚®ç®±å¯†ç  + è§’è‰²é€‰æ‹©

## ğŸ“‹ æ–‡ä»¶æ¸…å•

```
âœ… .env                                    # ç¯å¢ƒå˜é‡é…ç½®
âœ… src/lib/supabase.ts                     # Supabaseå®¢æˆ·ç«¯é…ç½®
âœ… src/contexts/AuthContext.tsx            # è®¤è¯ä¸Šä¸‹æ–‡
âœ… src/hooks/useAuth.ts                    # è®¤è¯Hook
âœ… src/components/AuthNavigation.tsx       # å¯¼èˆªæ ç»„ä»¶
âœ… src/components/AuthStatus.tsx           # çŠ¶æ€æ˜¾ç¤ºç»„ä»¶
âœ… src/components/Layout.tsx               # å¸ƒå±€ç»„ä»¶
âœ… src/pages/Login.tsx                     # ç™»å½•é¡µé¢
âœ… src/pages/Register.tsx                  # æ³¨å†Œé¡µé¢
âœ… src/pages/AuthTest.tsx                  # æµ‹è¯•é¡µé¢
âœ… supabase/migrations/*.sql               # RLSç­–ç•¥è¿ç§»
âœ… SUPABASE_AUTH_SETUP.md                  # è¯¦ç»†æ–‡æ¡£
âœ… init-supabase-auth.sh                   # åˆå§‹åŒ–è„šæœ¬
```

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ

1. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**:
   ```bash
   cd evolv-platform
   pnpm dev
   ```

2. **è®¿é—®åº”ç”¨**:
   - é¦–é¡µ: `http://localhost:5173`
   - æµ‹è¯•é¡µé¢: `http://localhost:5173/auth-test`

3. **æµ‹è¯•è®¤è¯åŠŸèƒ½**:
   - æ³¨å†Œä¸åŒè§’è‰²ç”¨æˆ·
   - éªŒè¯æƒé™æ˜¾ç¤º
   - æµ‹è¯•ç™»å½•/ç™»å‡º

4. **ç”Ÿäº§éƒ¨ç½²**:
   - é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
   - éƒ¨ç½²Supabaseè¿ç§»
   - æ„å»ºå’Œéƒ¨ç½²åº”ç”¨

---

âœ¨ **è®¤è¯ç³»ç»Ÿé…ç½®å®Œæˆï¼** ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨å®Œæ•´çš„å¤šè§’è‰²è®¤è¯åŠŸèƒ½äº†ã€‚